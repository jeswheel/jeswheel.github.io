<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jesse Wheeler">

<title>Jesse Wheeler - Stats 5100: Model Selection</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Jesse Wheeler</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./texDocs/cv.pdf"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./texDocs/researchStatement.pdf"> 
<span class="menu-text">Research Statement</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./texDocs/DEIstatement.pdf"> 
<span class="menu-text">Diversity Statement</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://panelpomp-org.github.io"> 
<span class="menu-text">PanelPomp</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#set-up" id="toc-set-up" class="nav-link active" data-scroll-target="#set-up">Set up</a></li>
  <li><a href="#logistics" id="toc-logistics" class="nav-link" data-scroll-target="#logistics">Logistics</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#review" id="toc-review" class="nav-link" data-scroll-target="#review">Review</a></li>
  <li><a href="#model-selection" id="toc-model-selection" class="nav-link" data-scroll-target="#model-selection">Model Selection</a></li>
  <li><a href="#question" id="toc-question" class="nav-link" data-scroll-target="#question">Question</a></li>
  <li><a href="#some-possible-reasons" id="toc-some-possible-reasons" class="nav-link" data-scroll-target="#some-possible-reasons">Some Possible reasons:</a></li>
  <li><a href="#what-we-will-cover-today" id="toc-what-we-will-cover-today" class="nav-link" data-scroll-target="#what-we-will-cover-today">What we will cover today</a></li>
  </ul></li>
  <li><a href="#overfitting" id="toc-overfitting" class="nav-link" data-scroll-target="#overfitting">Overfitting</a>
  <ul class="collapse">
  <li><a href="#statistical-bias" id="toc-statistical-bias" class="nav-link" data-scroll-target="#statistical-bias">Statistical Bias</a></li>
  <li><a href="#variance-of-an-estimator" id="toc-variance-of-an-estimator" class="nav-link" data-scroll-target="#variance-of-an-estimator">Variance of an estimator</a></li>
  <li><a href="#bias-variance-tradeoff" id="toc-bias-variance-tradeoff" class="nav-link" data-scroll-target="#bias-variance-tradeoff">Bias-Variance tradeoff</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  <li><a href="#exercise-fitting-polynomial-regression" id="toc-exercise-fitting-polynomial-regression" class="nav-link" data-scroll-target="#exercise-fitting-polynomial-regression">Exercise: Fitting polynomial regression</a></li>
  <li><a href="#question-1" id="toc-question-1" class="nav-link" data-scroll-target="#question-1">Question:</a></li>
  <li><a href="#model-selection-methods" id="toc-model-selection-methods" class="nav-link" data-scroll-target="#model-selection-methods">Model Selection Methods</a></li>
  </ul></li>
  <li><a href="#statistical-testing" id="toc-statistical-testing" class="nav-link" data-scroll-target="#statistical-testing">Statistical Testing</a>
  <ul class="collapse">
  <li><a href="#advantages" id="toc-advantages" class="nav-link" data-scroll-target="#advantages">Advantages</a></li>
  <li><a href="#disadvantages" id="toc-disadvantages" class="nav-link" data-scroll-target="#disadvantages">Disadvantages</a></li>
  <li><a href="#implementation-in-r" id="toc-implementation-in-r" class="nav-link" data-scroll-target="#implementation-in-r">Implementation in R</a></li>
  </ul></li>
  <li><a href="#adjusting-model-diagnostics" id="toc-adjusting-model-diagnostics" class="nav-link" data-scroll-target="#adjusting-model-diagnostics">Adjusting model diagnostics</a>
  <ul class="collapse">
  <li><a href="#adjusted-r2" id="toc-adjusted-r2" class="nav-link" data-scroll-target="#adjusted-r2">Adjusted <span class="math inline">\(R^2\)</span></a></li>
  <li><a href="#aic" id="toc-aic" class="nav-link" data-scroll-target="#aic">AIC</a></li>
  <li><a href="#additional-diagnostics" id="toc-additional-diagnostics" class="nav-link" data-scroll-target="#additional-diagnostics">Additional diagnostics</a></li>
  </ul></li>
  <li><a href="#testing-multiple-model-variations" id="toc-testing-multiple-model-variations" class="nav-link" data-scroll-target="#testing-multiple-model-variations">Testing multiple model variations</a>
  <ul class="collapse">
  <li><a href="#stepwise-regression" id="toc-stepwise-regression" class="nav-link" data-scroll-target="#stepwise-regression">Stepwise regression</a></li>
  <li><a href="#forward-selection" id="toc-forward-selection" class="nav-link" data-scroll-target="#forward-selection">Forward Selection</a></li>
  <li><a href="#backwards-elimination" id="toc-backwards-elimination" class="nav-link" data-scroll-target="#backwards-elimination">Backwards Elimination</a></li>
  <li><a href="#bidirectional-elimination-forward-backward" id="toc-bidirectional-elimination-forward-backward" class="nav-link" data-scroll-target="#bidirectional-elimination-forward-backward">Bidirectional elimination (forward-backward)</a></li>
  </ul></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation">Cross validation</a>
  <ul class="collapse">
  <li><a href="#testing-data" id="toc-testing-data" class="nav-link" data-scroll-target="#testing-data">Testing data</a></li>
  <li><a href="#data-splitting" id="toc-data-splitting" class="nav-link" data-scroll-target="#data-splitting">Data Splitting</a></li>
  <li><a href="#k-fold-cross-validation" id="toc-k-fold-cross-validation" class="nav-link" data-scroll-target="#k-fold-cross-validation"><span class="math inline">\(K\)</span>-fold cross-validation</a></li>
  <li><a href="#comments-on-cv" id="toc-comments-on-cv" class="nav-link" data-scroll-target="#comments-on-cv">Comments on CV</a></li>
  </ul></li>
  <li><a href="#interactive-exercise" id="toc-interactive-exercise" class="nav-link" data-scroll-target="#interactive-exercise">Interactive Exercise</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Stats 5100: Model Selection</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jesse Wheeler </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="set-up" class="level2">
<h2 class="anchored" data-anchor-id="set-up">Set up</h2>
<p>For today’s lecture I will use the R package <code>learnr</code>. If you would like to follow along interactively, you can download this file from my website: <a href="https://jeswheel.github.io">jeswheel.github.io</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(learnr)     <span class="co"># For interactive exercises</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you “<code>run</code>” the document in R-Studio, it will download the <code>learnr</code> package for you.</p>
</section>
<section id="logistics" class="level2">
<h2 class="anchored" data-anchor-id="logistics">Logistics</h2>
<ul>
<li>Any questions about previous material?</li>
</ul>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<section id="review" class="level3">
<h3 class="anchored" data-anchor-id="review">Review</h3>
<p>We are interested in fitting a linear regression model of the form:</p>
<p><span class="math display">\[
y_i = \beta_0 + \beta_1x_{1, i} + \ldots + \beta_{p-1}x_{p-1, i} + \beta_px_{p, i} + \epsilon_i,
\]</span> Where <span class="math inline">\(\epsilon_i\)</span> for all <span class="math inline">\(i = 1, 2, \ldots, n\)</span> are i.i.d. random noise terms with mean zero <span class="math inline">\(\big(\text{E}[\epsilon_i] = 0\big)\)</span> and variance <span class="math inline">\(\sigma^2\)</span> <span class="math inline">\(\big(\text{Var}(\epsilon_i) = \sigma^2\big)\)</span>.</p>
<ul>
<li>In this current setup, there are <span class="math inline">\(n\)</span> observations and <span class="math inline">\(p\)</span> variables.</li>
</ul>
</section>
<section id="model-selection" class="level3">
<h3 class="anchored" data-anchor-id="model-selection">Model Selection</h3>
<p>In real data analysis situations, people often have data for a response variable (<span class="math inline">\(\mathbf{y}\)</span>) and many possible regressors (<span class="math inline">\(\{\mathbf{x_i}\}_{i = 1}^p\)</span>).</p>
<p>Instead of fitting a model that describes the response variable using every available regressor, we are often interested in fitting a model to only a <em>subset</em> of the variables <span class="math inline">\(\{\mathbf{x_i}\}_{i = 1}^p\)</span>.</p>
<p>For example, suppose that <span class="math inline">\(p = 20\)</span> and we only want to include variables <span class="math inline">\(\mathbf{x}_{2}, \mathbf{x}_{10}\)</span>, and <span class="math inline">\(\mathbf{x}_{13}\)</span>:</p>
<p><span class="math display">\[
y_i = \beta_0 + \beta_2x_{2, i} + \beta_{10}x_{10, i} + \beta_{13}x_{13, i} + \epsilon_i,
\]</span></p>
</section>
<section id="question" class="level3">
<h3 class="anchored" data-anchor-id="question">Question</h3>
<p>What are some reasons that we might want to fit a model to only a subset of predictors?</p>
</section>
<section id="some-possible-reasons" class="level3">
<h3 class="anchored" data-anchor-id="some-possible-reasons">Some Possible reasons:</h3>
<ul>
<li><strong>Overfitting</strong>
<ul>
<li>When a model includes too many predictors, it can capture noise rather than the underlying relationship in the data.</li>
</ul></li>
<li><strong>Multicollinearity</strong>
<ul>
<li>Including highly correlated predictors can make it difficult to discern the individual effect of each predictor.</li>
</ul></li>
<li><strong>Interpretability</strong>
<ul>
<li>Models with many predictors can be difficult to describe to stakeholders; models with fewer variables can be more easily understood (and trusted) by non-statistical audiences.</li>
<li>This is a recurring theme in statistics, sometimes called <em>parsimony</em>: the simplest model that adequately describes the data is preferred (Occam’s Razor).</li>
</ul></li>
<li><strong>Cost and Feasibility</strong>
<ul>
<li>The model may be used to make predictions about newly obtained data, or motivate the collection of new data for future studies. If it is expensive / inconvenient to collect variables, it’s good to know which subset might be most important to collect.</li>
</ul></li>
</ul>
</section>
<section id="what-we-will-cover-today" class="level3">
<h3 class="anchored" data-anchor-id="what-we-will-cover-today">What we will cover today</h3>
<p>Today I hope to show give some examples demonstrating why we might want to do model selection, and common techniques used to select the subset model.</p>
<p>There will be some interactive exercises, so if you would like to participate and you’re having any trouble accessing this document, <strong>now is the time to let me know</strong>.</p>
</section>
</section>
<section id="overfitting" class="level2">
<h2 class="anchored" data-anchor-id="overfitting">Overfitting</h2>
<section id="statistical-bias" class="level3">
<h3 class="anchored" data-anchor-id="statistical-bias">Statistical Bias</h3>
<p>Suppose we are interested in an estimate of <span class="math inline">\(\mathbf{\beta}\)</span>, which we denote <span class="math inline">\(\hat{\mathbf{\beta}}\)</span>.</p>
<p>We would hope that the expected value of our estimate would be equal to the thing we are estimating:</p>
<p><span class="math display">\[
\text{E}[\hat{\mathbf{\beta}}] = \beta \hspace{4mm} \text{ or equivalently,} \hspace{4mm} 0 = \text{E}[\hat{\mathbf{\beta}}] - \beta
\]</span> The difference <span class="math inline">\(b = \text{E}[\hat{\mathbf{\beta}}] - \beta\)</span> is known as the <strong>bias</strong> of an estimate.</p>
<ul>
<li>The <strong>bias</strong> can be thought of as an consistent error (for example, under or over estimation), and is often the result of having a model that is <strong>too simple</strong>.</li>
</ul>
</section>
<section id="variance-of-an-estimator" class="level3">
<h3 class="anchored" data-anchor-id="variance-of-an-estimator">Variance of an estimator</h3>
<p>Using this same notation, the variance of the estimator is defined as: <span class="math inline">\(\text{Var}(\hat{\mathbf{\beta}})\)</span>.</p>
<ul>
<li>In this context, we think of this variance as how much our parameter estimates change if there are small changes in the training data. Large variance is often a result of having a model that is <strong>too complex</strong>.</li>
</ul>
</section>
<section id="bias-variance-tradeoff" class="level3">
<h3 class="anchored" data-anchor-id="bias-variance-tradeoff">Bias-Variance tradeoff</h3>
<ul>
<li>As the number of parameters of a model increase (i.e., more model complexity), the model can better fit the data, <strong>reducing bias</strong>.</li>
<li>However, larger models have <strong>increased variance</strong>, as every time we obtain a different sample the model fit will change.</li>
</ul>
<p>For regression models, it can be shown that the total expected error is the sum of the variance of your estimator and the squared bias:</p>
<p><span class="math display">\[
\text{Expected error} =  \text{Var}(\hat{\mathbf{\beta}}) + \big(\text{E}[\hat{\mathbf{\beta}}] - \beta\big)^2
\]</span> Because our goal is to minimize the total error, we want to find a model that balances this <em>bias-variance tradeoff</em>: <a href="https://en.wikipedia.org/wiki/Bias%E2%80%93variance_tradeoff#/media/File:Bias_and_variance_contributing_to_total_error.svg">Bias-variance figure 1</a>, <a href="https://images.app.goo.gl/w12M4k4z6sJ2Ykkk6">Bias-variance figure 2</a>.</p>
</section>
<section id="example" class="level3">
<h3 class="anchored" data-anchor-id="example">Example</h3>
<p>Suppose that I have a response variable <span class="math inline">\(y\)</span> and only a single predictor variable <span class="math inline">\(x\)</span> that have a non-linear relationship:</p>
<p><span class="math display">\[
y_i = f(x_i) + \epsilon_i
\]</span></p>
<p>I have simulated such as example in <code>R</code>, saved into an object called <code>df_poly</code>.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="USU_files/figure-html/polyregFig-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If I don’t know what this relationship is, I might consider fitting a polynomial regression model:</p>
<p><span class="math display">\[
y_i = \beta_0 + \beta_1 x_1 + \beta_2 x_2^2 + \ldots + \beta_px_p^p + \epsilon_p
\]</span> The question remains: how many variables should I fit to the data?</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="USU_files/figure-html/polyregFigEx-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="exercise-fitting-polynomial-regression" class="level3">
<h3 class="anchored" data-anchor-id="exercise-fitting-polynomial-regression">Exercise: Fitting polynomial regression</h3>
<p>Try finding a value of <span class="math inline">\(p\)</span> that provides a suitable fit to the data in <code>df_poly</code>.</p>
<p>To fit a polynomial regression model in <code>R</code>, we need to use the following for our <code>formulas</code>:</p>
<pre><code>lm(Y~X + I(X^2) + ... + I(X^p), data = df_poly)</code></pre>
<p>Here the function <span class="math inline">\(I()\)</span> tells <code>R</code> to interpret <code>X^2</code> as the square of <code>X</code>.</p>
<div class="cell" data-exercise="true" data-exercise.eval="true">
<div class="tutorial-exercise" data-label="polyreg" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_poly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           x        y
1  0.5855288 13.78895
2  0.7094660 14.55087
3 -0.1093033 15.12250
4 -0.4534972 15.41938
5  0.6058875 16.05119
6 -1.8179560 12.16711</code></pre>
</div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="polyreg-hint-1" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You can fit a 2-degree polynomial regression model using:</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>poly_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y<span class="sc">~</span>x<span class="sc">+</span><span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> df_poly)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># To get a diagnostic summary, try plotting the output:</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(poly_fit)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Or take a summary:</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poly_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="polyreg-hint-2" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You can easily plot your fit using ggplot: </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df_poly, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">'lm'</span>, </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># In this case, I'm plotting a 2-degree polynomial. </span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># The only thing you need to change is to plug in the formula that you would like to plot. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<!-- ### Model Selection -->
<!-- Model selection can help us with the bias-variance tradeoff. To demonstrate this, we will look at an example in `R`.  -->
<!-- - Suppose we have 500 observations of 50 predictor variables and a single response variable. The model, in matrix form, is $\mathbf{y} = \mathbf{X}\beta + \mathbf{\epsilon}$. -->
<!-- - We are going to assume only a few variables (7) are actually related to $\mathbf{y}$. That is, the vector $\mathbf{\beta}$ is equal zero everywhere except for in 7 places.  -->
</section>
<section id="question-1" class="level3">
<h3 class="anchored" data-anchor-id="question-1">Question:</h3>
<p>Previously, we have discussed methods of assessing the goodness-of-fit of any given regression model (for example, <span class="math inline">\(\text{R}^2\)</span>, MSE and visual checks of residuals).</p>
<p><strong>Problem:</strong> if we use these evaluations on the data we use to fit the model, they will always suggest using a larger model.</p>
<p><strong>Question:</strong> What do you think we might try in order to perform model selection?</p>
</section>
<section id="model-selection-methods" class="level3">
<h3 class="anchored" data-anchor-id="model-selection-methods">Model Selection Methods</h3>
<ul>
<li>A statistical test of significance (ANOVA).</li>
<li>Consider adding a penalty to model diagnostics.</li>
</ul>
</section>
</section>
<section id="statistical-testing" class="level2">
<h2 class="anchored" data-anchor-id="statistical-testing">Statistical Testing</h2>
<p>We can actually perform a statistical test comparing a larger model to a nested version of the model.</p>
<p>For instance, consider the base model with four variables (which we call <span class="math inline">\(M_1\)</span>):</p>
<p><span class="math display">\[
y_i = \beta_0 + \beta_1x_{1, i} + \beta_2x_{2, i} + \beta_3x_{3, i} + \beta_4x_{4, i} + \epsilon_i,
\]</span> and we would like to compare this to a smaller nested model (which we call <span class="math inline">\(M_0\)</span>): <span class="math display">\[
y_i = \beta_0 + \beta_2x_{2, i} + \beta_3x_{3, i} + \epsilon_i,
\]</span></p>
<p>This smaller model is considered <em>nested</em> because it’s actually the same model, just setting <span class="math inline">\(\beta_1 = \beta_4 = 0\)</span>.</p>
<p>(Here I have chosen variables and coefficients corresponding to the indices <span class="math inline">\(2, 3\)</span> as an example, but this works for arbitrary numbers of original variables <span class="math inline">\(p\)</span> and subset sizes).</p>
<ul>
<li>We can calculate an F-test statistic by considering the ratio: <span class="math display">\[
F = \frac{\Delta\text{SSE}/\Delta p}{\text{MSE}_1},
\]</span> where <span class="math inline">\(\Delta\text{SSE} = \text{SSE}_0 - \text{SSE}_1\)</span>, and <span class="math inline">\(\Delta p\)</span> is the difference in the number of model parameters (i.e., the number of coefficients being tested).</li>
</ul>
<section id="advantages" class="level3">
<h3 class="anchored" data-anchor-id="advantages">Advantages</h3>
<ul>
<li>Simplicity</li>
<li>Formal Hypothesis testing framework</li>
<li>Easy to implement</li>
</ul>
</section>
<section id="disadvantages" class="level3">
<h3 class="anchored" data-anchor-id="disadvantages">Disadvantages</h3>
<ul>
<li>Can be too conservative
<ul>
<li>We only pick the larger model if we reject the null hypothesis. The test is designed to control type I errors, meaning we want to limit number of times we reject if the null is true (leading to fewer rejections and selecting simple models).</li>
</ul></li>
<li>Issues with multiple-testing
<ul>
<li>If we want to do this test for multiple nested models, we run into a <em>multiple-testing</em> issue, which means we may not be controlling the type-I error rate.</li>
</ul></li>
<li>Assumes normally distributed error terms.</li>
</ul>
</section>
<section id="implementation-in-r" class="level3">
<h3 class="anchored" data-anchor-id="implementation-in-r">Implementation in R</h3>
<p>In <code>R</code>, there are various ways you can do this type of test, but an easy way is using the <code>anova</code> function. This is demonstrated below on the <code>mtcars</code> dataset, which contains data about cars in the 1970’s:</p>
<div class="cell" data-exercise="true" data-exercise.setup="mtcarsSetup">
<div class="tutorial-exercise" data-label="mtcarsExplore" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell" data-exercise="true" data-exercise.setup="mtcarsSetup">
<div class="tutorial-exercise" data-label="mtcarsPlot" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg)) <span class="sc">+</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Car Weight (1000 lbs)"</span>, <span class="at">y =</span> <span class="st">"Miles/Gallon"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<p>There seems to be a strong correlation between the weight of a car (<code>wt</code>) and its gas mileage (<code>mpg</code>). We can test this model against and alternative that includes additional variables:</p>
<div class="cell" data-exercise="true" data-exercise.setup="mtcarsSetup">
<div class="tutorial-exercise" data-label="mtcarsAnova" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the full model</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>full_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> wt <span class="sc">+</span> hp <span class="sc">+</span> qsec <span class="sc">+</span> disp <span class="sc">+</span> drat, <span class="at">data =</span> mtcars)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the reduced model (nested within the full model)</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>reduced_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> wt, <span class="at">data =</span> mtcars)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(reduced_model, full_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
</section>
</section>
<section id="adjusting-model-diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="adjusting-model-diagnostics">Adjusting model diagnostics</h2>
<p>Another approach is to adjust model diagnostics by adding a <em>penalty</em> for larger models.</p>
<section id="adjusted-r2" class="level3">
<h3 class="anchored" data-anchor-id="adjusted-r2">Adjusted <span class="math inline">\(R^2\)</span></h3>
<p>One example is to penalize the <span class="math inline">\(\text{R}^2\)</span> statistic. Recall that <span class="math inline">\(\text{R}^2\)</span> represents the proportion of variation in the data that can be explained by the model.</p>
<ul>
<li><span class="math inline">\(\text{R}^2\)</span> can be written as: <span class="math display">\[
R^2 = 1 - \frac{\text{SS}_{\text{error}}}{\text{SS}_{\text{total}}}
\]</span></li>
<li>The adjusted <span class="math inline">\(\text{R}^2\)</span> is: <span class="math display">\[
R_{\text{adj}}^2 = 1 - \frac{\text{SS}_{\text{error}}/(n-p)}{\text{SS}_{\text{total}}/(n-1)} = 1 - \frac{(1 - \text{R}^2)(n - 1)}{n - p - 1}
\]</span></li>
</ul>
<p>While <span class="math inline">\(\text{R}^2\)</span> always increases when extra variables are added to the model, adjusted <span class="math inline">\(\text{R}^2\)</span> only increases when the improvement in <span class="math inline">\(\text{R}^2\)</span> (due to the inclusion of a new variable) is more than one would expect to see by chance.</p>
<p>In <code>R</code>, the adjusted <span class="math inline">\(\text{R}^2\)</span> statistic can be obtained by summarizing an <code>lm</code> object:</p>
<div class="cell" data-exercise="true" data-exercise.setup="mtcarsSetup">
<div class="tutorial-exercise" data-label="adjR2" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>car_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg<span class="sc">~</span>cyl<span class="sc">+</span>disp<span class="sc">+</span>hp<span class="sc">+</span>wt, <span class="at">data =</span> mtcars)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(car_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
</section>
<section id="aic" class="level3">
<h3 class="anchored" data-anchor-id="aic">AIC</h3>
<p>The log-likelihood of a model is a useful comparison tool; a model with a higher log-likelihood describes the available data better than a model with lower log-likelihood.</p>
<p>Like <span class="math inline">\(\text{R}^2\)</span>, the log-likelihood does not account for model complexity, and therefore adding new variables into the model will always increase the log-likelihood.</p>
<ul>
<li>Akaike’s information criterion (AIC) adjusted the log-likelihood by adding a penalty for the number of variables used. <span class="math display">\[
\text{AIC} = 2p - 2 \times \text{log-likelihood}
\]</span></li>
<li>Given a set of candidate models, the preferred model is the one with the smallest AIC.</li>
</ul>
<p>AIC was first developed in the case where models parameters are estimated by maximum likelihood estimation (i.e., finding parameter values that have the highest log-likelihood). If the model was fit in this way, then the AIC has some interesting theoretical properties.</p>
<p>In <code>R</code>, the AIC statistic can be obtained by using the <code>AIC</code> function on an <code>lm</code> object:</p>
<div class="cell" data-exercise="true" data-exercise.setup="mtcarsSetup">
<div class="tutorial-exercise" data-label="mtcarsAIC" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>car_mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg<span class="sc">~</span>cyl<span class="sc">+</span>disp<span class="sc">+</span>hp<span class="sc">+</span>wt, <span class="at">data =</span> mtcars)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>car_mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg<span class="sc">~</span>hp<span class="sc">+</span>wt, <span class="at">data =</span> mtcars)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(car_mod1)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(car_mod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
</section>
<section id="additional-diagnostics" class="level3">
<h3 class="anchored" data-anchor-id="additional-diagnostics">Additional diagnostics</h3>
<p>There are various other diagnostic statistics that we might use to compare models.</p>
<ul>
<li>Approaches that adjust for model complexity: adjusted <span class="math inline">\(\text{R}^2\)</span>, AIC, AICC, BIC, Mallow’s <span class="math inline">\(C_p\)</span>.</li>
<li>There are also approaches that do not adjust for model complexity, such as the MSE.</li>
</ul>
<p><strong>Question:</strong> How do we know which to use?</p>
</section>
</section>
<section id="testing-multiple-model-variations" class="level2">
<h2 class="anchored" data-anchor-id="testing-multiple-model-variations">Testing multiple model variations</h2>
<section id="stepwise-regression" class="level3">
<h3 class="anchored" data-anchor-id="stepwise-regression">Stepwise regression</h3>
<p>So far we have only discussed approaches for comparing two candidate models. In order to find an optimal subset of variables to use in a model, we could fit all possible models using a subset of the available predictor variables.</p>
<p>Suppose we have <span class="math inline">\(p\)</span> predictor variables available. Then the total number of candidate models is <span class="math inline">\(2^p\)</span>. Even with a relatively small number <span class="math inline">\(p = 20\)</span>, this would require fitting more than one million models!</p>
<p>To find a suitable subset model, we will focus on <em>stepwise regression</em> techniques. These approaches are <em>greedy</em> algorithms (a greedy algorithm won’t necessarily give us the “best” answer, but will give an answer based on locally optimal solutions).</p>
<p>These algorithms include <strong>forward selection</strong>, <strong>backward elimination</strong>, and <strong>bidirectional elimination</strong> (aka forward-backward elimination).</p>
</section>
<section id="forward-selection" class="level3">
<h3 class="anchored" data-anchor-id="forward-selection">Forward Selection</h3>
<ul>
<li>Start with a model with <strong>no variables</strong>.</li>
<li>Evaluate the effect of adding each remaining candidate variable (one at a time) to the current model.</li>
<li>Add the variable that most improves the model according to the chosen criterion (e.g., decreases AIC/BIC the most, increases adjusted R-squared the most, etc.).</li>
<li>Repeat until no variables improve the model based on our criterion.</li>
</ul>
</section>
<section id="backwards-elimination" class="level3">
<h3 class="anchored" data-anchor-id="backwards-elimination">Backwards Elimination</h3>
<ul>
<li>Start with all variables.</li>
<li>Test the removal of each variable using the chosen criterion, and remove a variable if the criterion improves with the removal of the variable.</li>
<li>Repeat this process until no further variables can be removed without a reduction in the selected criterion.</li>
</ul>
</section>
<section id="bidirectional-elimination-forward-backward" class="level3">
<h3 class="anchored" data-anchor-id="bidirectional-elimination-forward-backward">Bidirectional elimination (forward-backward)</h3>
<ul>
<li>Combination of both forward and backward elimination.</li>
<li>Start with a candidate model (often either intercept only, or all variables).</li>
<li>If possible, do a forward step by considering to add a single variable (one at a time) to the current model.</li>
<li>After adding a variable, evaluate the effect of removing each variable (one at a time) from the current model (if possible).</li>
<li>Continue this process until no more variables can be added or removed to improve the model further.</li>
</ul>
<!-- This one is a bit more confusing, so let's look at a concrete example:  -->
<!-- Suppose we have a dataset with the response variable \( Y \) and predictor variables \( X_1, X_2, X_3, \) and \( X_4 \). -->
<!-- 1. **Initialization**: -->
<!--    - Start with the null model: \( Y \) ~ 1 (intercept only). -->
<!-- 2. **Forward Step**: -->
<!--    - Evaluate the addition of each variable \( X_1, X_2, X_3, \) and \( X_4 \) individually. -->
<!--    - Suppose adding \( X_2 \) provides the biggest improvement based on AIC, so add \( X_2 \). -->
<!--      - Model: \( Y \) ~ 1 + \( X_2 \). -->
<!-- 3. **Backward Step**: -->
<!--    - Now evaluate if removing \( X_2 \) from the current model is beneficial, but since we just added it and the criterion suggests its presence is valuable, we keep \( X_2 \). -->
<!-- 4. **Forward Step**: -->
<!--    - Evaluate adding the remaining variables \( X_1, X_3, \) and \( X_4 \) to the model with \( X_2 \). -->
<!--    - Suppose adding \( X_1 \) provides the biggest improvement. -->
<!--      - Model: \( Y \) ~ \(1 + X_2 + X_1 \). -->
<!-- 5. **Backward Step**: -->
<!--    - Now evaluate if removing either \( X_2 \) or \( X_1 \) from the model \( Y \) ~ \( X_2 + X_1 \) improves it. -->
<!--    - Suppose removing \( X_1 \) actually worsens the model, but removing \( X_2 \) slightly improves it. -->
<!--      - Model: \( Y \) ~ \(1 + X_1 \). -->
<!-- 6. **Iterate**: -->
<!--    - Go back to the forward step and consider adding \( X_2, X_3, \) or \( X_4 \) to the model \( Y \) ~ \( X_1 \). -->
<!--    - Suppose \( X_3 \) adds the most benefit this time. -->
<!--      - Model: \( Y \) ~ \(1 + X_1 + X_3 \). -->
<!-- 7. **Backward Step**: -->
<!--    - Evaluate if removing \( X_1 \) or \( X_3 \) from the model improves fit. -->
<!--    - Continue iterating through forward and backward steps as described. -->
<!-- 8. **Stop Condition**: -->
<!--    - The process halts when no addition or removal of variables improves the model based on the selected criterion. -->
<p>If you want to use AIC as the criterion, each of these approaches can be implemented in <code>R</code> with the <code>step</code> function.</p>
<p><strong>Exercise:</strong> Try using the <code>step</code> function in <code>R</code> to select a model for the <code>mtcars</code> dataset.</p>
<div class="cell" data-exercise="true" data-exercise.setup="mtcarsSetup">
<div class="tutorial-exercise" data-label="stepWise" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>null_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> mtcars)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>full_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> ., <span class="at">data =</span> mtcars)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">step</span>(full_model, <span class="at">direction =</span> <span class="st">'backward'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="stepWise-hint-1" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To go forward, you need to provide a "Scope" </span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The scope basically is the largest model you want it to consider: </span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>scope <span class="ot">=</span> <span class="fu">list</span>(<span class="at">upper =</span> full_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="stepWise-hint-2" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To do bidirectional, you need scope to have a lower and an upper</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>scope <span class="ot">=</span> <span class="fu">list</span>(<span class="at">upper =</span> full_model, <span class="at">lower =</span> null_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="stepWise-solution" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### SOLUTION #### </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Backwards</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">step</span>(full_model, <span class="at">direction =</span> <span class="st">'backward'</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forwards</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  full_model, <span class="at">direction =</span> <span class="st">'forward'</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">scope =</span> <span class="fu">list</span>(<span class="at">upper =</span> full_model)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Forward-Backward</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="fu">step</span>(</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  null_model, <span class="at">direction =</span> <span class="st">'both'</span>,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">scope =</span> <span class="fu">list</span>(<span class="at">upper =</span> full_model, <span class="at">lower =</span> null_model)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Backward-Forward </span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="fu">step</span>(</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  full_model, <span class="at">direction =</span> <span class="st">'both'</span>,</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">scope =</span> <span class="fu">list</span>(<span class="at">upper =</span> full_model, <span class="at">lower =</span> null_model)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
</section>
<section id="cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="cross-validation">Cross validation</h2>
<p>When we fit a model to data, we are typically interested in how well our fitted model generalized to <strong>new</strong> datasets.</p>
<p>Unfortunately, we usually can’t directly assess how well the model generalizes because we don’t have new data.</p>
<section id="testing-data" class="level3">
<h3 class="anchored" data-anchor-id="testing-data">Testing data</h3>
<p>In an ideal scenario, we can have two distinct datasets. We will use one for training (call it the training data), and another for testing (call it the testing data).</p>
<p>To see why this is useful, let’s revisit the polynomial regression example. We start with the same 200 observations that we had before, but now let’s assume I have a second dataset from the same data generating process that has 1000 observations (saved as <code>df_poly_test</code>).</p>
<p>We can now consider how many polynomial regression variables should be included in our model based on how well the model fits the test data. We will measure goodness-of-fit in this case using RMSE.</p>
<div class="cell" data-exercise="true">
<div class="tutorial-exercise" data-label="polyTestSet" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to evaluate MSE of model predictions</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>MSE <span class="ot">&lt;-</span> <span class="cf">function</span>(Y, Y_hat) {</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>((Y <span class="sc">-</span> Y_hat)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the maximum degree of the polynomial model</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>max_p <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data.frame object to save results of training data</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>results_train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">degree =</span> <span class="dv">1</span><span class="sc">:</span>max_p, </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">MSE =</span> <span class="cn">NA_real_</span>, </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">set =</span> <span class="st">'train'</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data.frame object to save results of testing data </span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>results_test <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">degree =</span> <span class="dv">1</span><span class="sc">:</span>max_p, </span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">MSE =</span> <span class="cn">NA_real_</span>, </span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">set =</span> <span class="st">'test'</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co"># For each p in 1:max_p, fit a polynomial model of degree p, and calculate </span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="co"># the MSE on the training and testing data.</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (p <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>max_p) {</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit model on training data </span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  poly_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span><span class="fu">poly</span>(x, p), <span class="at">data =</span> df_poly)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make Y predictions on training data</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  train_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(poly_model, <span class="at">newdata =</span> df_poly)</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make Y predictions on testing data </span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>  test_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(poly_model, <span class="at">newdata =</span> df_poly_test)</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate MSE and save the results </span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>  results_train[p, <span class="st">'MSE'</span>] <span class="ot">&lt;-</span> <span class="fu">MSE</span>(df_poly<span class="sc">$</span>y, train_predictions)</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>  results_test[p, <span class="st">'MSE'</span>] <span class="ot">&lt;-</span> <span class="fu">MSE</span>(df_poly_test<span class="sc">$</span>y, test_predictions)</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine results into a single data.frame object </span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>  results_train, results_test</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the results</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(results, <span class="fu">aes</span>(<span class="at">x =</span> degree, <span class="at">y =</span> MSE, <span class="at">col =</span> set)) <span class="sc">+</span> </span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> MSE)) <span class="sc">+</span> </span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Polynomial Degree"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<p>Note that testing works best if you have a lot a data that you can use for testing.</p>
</section>
<section id="data-splitting" class="level3">
<h3 class="anchored" data-anchor-id="data-splitting">Data Splitting</h3>
<p>In the absence of a new dataset we can test on, we have to figure something else out.</p>
<p>If we have a large amount of data, one idea is to split the data into two parts: one for training, and one for testing.</p>
<p>We don’t necessarily have to split the data evenly. For example, it’s common to see a split of 80/20, where <span class="math inline">\(80\%\)</span> of the data are used for training.</p>
<p>If there is a lot of data available, then the test set provide a representative sample of how the model performs on unseen data.</p>
<p><strong>Question:</strong> How is this different from just having two separate datasets? Why might the this cause a disadvantage?</p>
<p><strong>Question:</strong> What could we try if we don’t have a lot of data?</p>
</section>
<section id="k-fold-cross-validation" class="level3">
<h3 class="anchored" data-anchor-id="k-fold-cross-validation"><span class="math inline">\(K\)</span>-fold cross-validation</h3>
<p>A sampling procedure that reuses a limited data sample to evaluate model predictive performance.</p>
<p>In a <span class="math inline">\(K\)</span>-fold cross validation (CV):</p>
<ul>
<li>Divide the data sample (evenly) into <span class="math inline">\(K\)</span> sets (folds).</li>
<li>In each fold, use (<span class="math inline">\(K - 1\)</span>) sets for model fitting (i.e.&nbsp;training), and the remaining set for evaluating model prediction (i.e., testing).</li>
<li>Repeat the above step <span class="math inline">\(K\)</span> times, rotating the training and test sets.</li>
<li>Evaluate the overall performance by averaging the results across folds.</li>
</ul>
<p>Here is a visual representation of <a href="https://www.sharpsightlabs.com/wp-content/uploads/2024/02/5-fold-cross-validation_SIMPLE-EXAMPLE_v2.png"><span class="math inline">\(5\)</span>-fold cross validation</a>.</p>
</section>
<section id="comments-on-cv" class="level3">
<h3 class="anchored" data-anchor-id="comments-on-cv">Comments on CV</h3>
<ul>
<li>Popular choices of <span class="math inline">\(K\)</span> (number of folds) are <span class="math inline">\(3, 5, 10, 20\)</span>, with <span class="math inline">\(10\)</span> being the most common.</li>
<li>Another choice is called leave-one-out cross validation (LOOCV), which is like picking <span class="math inline">\(K\)</span> to be the number observations in the data. This can be computationally prohibitive.</li>
</ul>
<p>Some relative terminology includes:</p>
<ul>
<li><strong>in-sample evaluation</strong>: model evaluation done on the training data.</li>
<li><strong>out-of-sample evaluation</strong>: model evaluation on data the trained model hasn’t seed (i.e., test set).</li>
</ul>
</section>
</section>
<section id="interactive-exercise" class="level2">
<h2 class="anchored" data-anchor-id="interactive-exercise">Interactive Exercise</h2>
<p>You have just learned about K-Fold Cross Validation in our previous class. Now, you will apply this technique to the <code>mtcars</code> dataset in <code>R</code> to evaluate the performance of a linear regression model for the variable <code>mpg</code>.</p>
<p>You can pick any regressors you would like, but a good starting point might be the formula: <code>mpg ~ disp + hp + wt</code>.</p>
<p>Steps:</p>
<ol type="1">
<li><strong>Shuffle the dataset</strong>. Randomly shuffle the rows of the dataset.</li>
<li><strong>Split the dataset into K folds</strong>. For this task, let K = 5.</li>
<li><strong>Perform K-fold cross-validation</strong>.
<ul>
<li>For each fold, fit a linear regression model on the training data (i.e., all folds except the current fold).</li>
<li>Evaluate the model’s performance on the test data (i.e., the current fold).</li>
<li>Record the prediction error for each fold. Use Mean Squared Error (MSE) as the metric.</li>
</ul></li>
<li><strong>Calculate the average prediction error</strong> across all K folds.</li>
</ol>
<p>Implement this procedure from scratch using <code>R</code>. There are multiple ways you could do this, so the provided hints demonstrate only one possible approach.</p>
<div class="cell" data-exercise="true" data-exercise.setup="mtcarsSetup" data-exercise.eval="true">
<div class="tutorial-exercise" data-label="mtcarsCV" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)  <span class="co"># for reproducibility</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   mpg cyl disp  hp drat    wt  qsec vs am gear carb
Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
</div>
<script type="application/json" data-ui-opts="1">{"engine":"r","has_checker":false,"caption":"<span data-i18n=\"text.enginecap\" data-i18n-opts=\"{&quot;engine&quot;:&quot;R&quot;}\">R Code<\/span>"}</script>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="mtcarsCV-hint-1" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First we want to shuffle the data. Why? </span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Sometimes there may be some features of the data recording process so that </span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># data that are close to each other in the dataset may be more closely related </span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># than those that are further apart. We want to avoid this in our evaluations. </span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>df_cars <span class="ot">&lt;-</span> mtcars[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mtcars)), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="mtcarsCV-hint-2" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting up the k-folds. </span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The number of observations cannot be evenly split into 5 folds. You need </span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># to account for this somehow. </span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># One possible approach:</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   (7 observations in folds 1 &amp; 2, 6 observations in all other folds)</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>), <span class="at">length.out =</span> <span class="fu">nrow</span>(df_cars))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="tutorial-exercise-support" data-label="mtcarsCV-hint-3" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0" data-pipe="|>">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You may need to do the following: </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up a vector to save the results for each fold: </span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>mse_results <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a for-loop over the number of folds: </span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ... </span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Within the for-loop, get training and testing sets for current value of k. </span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Here's how you might get the test set if k == 1: </span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>is_test_set <span class="ot">&lt;-</span> folds <span class="sc">==</span> <span class="dv">1</span> </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>df_test <span class="ot">&lt;-</span> df_cars[is_test_set, ]</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="do">### How can you extend this for all k, and to both train and test sets? </span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co"># You also need to fit the model, evaluate, and save results within the loop.</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co"># For example: </span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>mod_k <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> disp <span class="sc">+</span> hp <span class="sc">+</span> wt, <span class="at">data =</span> df_train)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>predict_k <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_k, <span class="at">newdata =</span> df_test)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>mse_k <span class="ot">&lt;-</span> <span class="fu">mean</span>((predict_k <span class="sc">-</span> df_test<span class="sc">$</span>mpg)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>mse_results <span class="ot">&lt;-</span> <span class="fu">c</span>(mse_results, mse_k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>
<script type="application/shiny-prerendered" data-context="server">
learnr:::register_http_handlers(session, metadata = NULL)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::prepare_tutorial_state(session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::i18n_observe_tutorial_language(input, session)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
session$onSessionEnded(function() {
        learnr:::event_trigger(session, "session_stop")
      })
</script>
 
<script type="application/shiny-prerendered" data-context="server-start">
library(learnr)
theme_set(theme_bw())
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-polyreg-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-polyreg-code-editor`)), session)
output$`tutorial-exercise-polyreg-output` <- renderUI({
  `tutorial-exercise-polyreg-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "polyreg", global_setup = structure(c("library(learnr)", 
"theme_set(theme_bw())"), chunk_opts = list(label = "setup", 
    eval = TRUE, include = FALSE, message = FALSE, echo = FALSE)), 
    setup = "set.seed(12345)\nn <- 200\nX <- rnorm(n, mean = 0, sd = 1)\nY <- 12 + 3*cos(X) + X + 0.5* X^2 - 0.16 * X^3 + ifelse(X > 1, 0.25*X^2, 0) + rnorm(n, sd = 1) \ndf_poly <- data.frame(\n  x = X, \n  y = Y\n)", 
    chunks = list(list(label = "polyreg-setup", code = "set.seed(12345)\nn <- 200\nX <- rnorm(n, mean = 0, sd = 1)\nY <- 12 + 3*cos(X) + X + 0.5* X^2 - 0.16 * X^3 + ifelse(X > 1, 0.25*X^2, 0) + rnorm(n, sd = 1) \ndf_poly <- data.frame(\n  x = X, \n  y = Y\n)", 
        opts = list(label = "\"polyreg-setup\""), engine = "r"), 
        list(label = "polyreg", code = "head(df_poly)", opts = list(
            label = "\"polyreg\"", exercise = "TRUE", exercise.eval = "TRUE"), 
            engine = "r")), code_check = NULL, error_check = NULL, 
    check = NULL, solution = NULL, tests = NULL, options = list(
        eval = TRUE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "USU_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "USU_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = TRUE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fig.asp = NULL, fenced.echo = FALSE, ft.shadow = FALSE, 
        label = "polyreg", exercise = TRUE, exercise.eval = TRUE, 
        original.params.src = "r polyreg, exercise=TRUE, exercise.eval=TRUE", 
        chunk.echo = FALSE, code = "head(df_poly)", out.width.px = 672L, 
        out.height.px = 480L, params.src = "r polyreg, exercise=TRUE, exercise.eval=TRUE", 
        fig.alt = NULL, fig.num = 0, exercise.df_print = "default", 
        exercise.checker = "NULL"), engine = "r", version = "4"), class = c("r", 
"tutorial_exercise")))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-mtcarsExplore-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-mtcarsExplore-code-editor`)), session)
output$`tutorial-exercise-mtcarsExplore-output` <- renderUI({
  `tutorial-exercise-mtcarsExplore-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "mtcarsExplore", global_setup = structure(c("library(learnr)", 
"theme_set(theme_bw())"), chunk_opts = list(label = "setup", 
    eval = TRUE, include = FALSE, message = FALSE, echo = FALSE)), 
    setup = "data(\"mtcars\")", chunks = list(list(label = "mtcarsSetup", 
        code = "data(\"mtcars\")", opts = list(label = "\"mtcarsSetup\"", 
            echo = "FALSE", include = "FALSE"), engine = "r"), 
        list(label = "mtcarsExplore", code = "summary(mtcars)", 
            opts = list(label = "\"mtcarsExplore\"", exercise = "TRUE", 
                exercise.setup = "\"mtcarsSetup\""), engine = "r")), 
    code_check = NULL, error_check = NULL, check = NULL, solution = NULL, 
    tests = NULL, options = list(eval = FALSE, echo = TRUE, results = "markup", 
        tidy = FALSE, tidy.opts = NULL, collapse = FALSE, prompt = FALSE, 
        comment = NA, highlight = FALSE, size = "normalsize", 
        background = "#F7F7F7", strip.white = TRUE, cache = 0, 
        cache.path = "USU_cache/html/", cache.vars = NULL, cache.lazy = TRUE, 
        dependson = NULL, autodep = FALSE, cache.rebuild = FALSE, 
        fig.keep = "high", fig.show = "asis", fig.align = "default", 
        fig.path = "USU_files/figure-html/", dev = "png", dev.args = NULL, 
        dpi = 192, fig.ext = "png", fig.width = 7L, fig.height = 5L, 
        fig.env = "figure", fig.cap = NULL, fig.scap = NULL, 
        fig.lp = "fig:", fig.subcap = NULL, fig.pos = "", out.width = 672L, 
        out.height = NULL, out.extra = NULL, fig.retina = 2, 
        external = TRUE, sanitize = FALSE, interval = 1, aniopts = "controls,loop", 
        warning = TRUE, error = FALSE, message = TRUE, render = NULL, 
        ref.label = NULL, child = NULL, engine = "r", split = FALSE, 
        include = TRUE, purl = TRUE, fig.asp = NULL, fenced.echo = FALSE, 
        ft.shadow = FALSE, label = "mtcarsExplore", exercise = TRUE, 
        exercise.setup = "mtcarsSetup", original.params.src = "r mtcarsExplore, exercise=TRUE, exercise.setup=\"mtcarsSetup\"", 
        chunk.echo = FALSE, code = "summary(mtcars)", out.width.px = 672L, 
        out.height.px = 480L, params.src = "r mtcarsExplore, exercise=TRUE, exercise.setup=\"mtcarsSetup\"", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-mtcarsPlot-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-mtcarsPlot-code-editor`)), session)
output$`tutorial-exercise-mtcarsPlot-output` <- renderUI({
  `tutorial-exercise-mtcarsPlot-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "mtcarsPlot", global_setup = structure(c("library(learnr)", 
"theme_set(theme_bw())"), chunk_opts = list(label = "setup", 
    eval = TRUE, include = FALSE, message = FALSE, echo = FALSE)), 
    setup = "data(\"mtcars\")", chunks = list(list(label = "mtcarsSetup", 
        code = "data(\"mtcars\")", opts = list(label = "\"mtcarsSetup\"", 
            echo = "FALSE", include = "FALSE"), engine = "r"), 
        list(label = "mtcarsPlot", code = "ggplot(mtcars, aes(x = wt, y = mpg)) + \n  geom_point() + \n  labs(x = \"Car Weight (1000 lbs)\", y = \"Miles/Gallon\")", 
            opts = list(label = "\"mtcarsPlot\"", exercise = "TRUE", 
                exercise.setup = "\"mtcarsSetup\""), engine = "r")), 
    code_check = NULL, error_check = NULL, check = NULL, solution = NULL, 
    tests = NULL, options = list(eval = FALSE, echo = TRUE, results = "markup", 
        tidy = FALSE, tidy.opts = NULL, collapse = FALSE, prompt = FALSE, 
        comment = NA, highlight = FALSE, size = "normalsize", 
        background = "#F7F7F7", strip.white = TRUE, cache = 0, 
        cache.path = "USU_cache/html/", cache.vars = NULL, cache.lazy = TRUE, 
        dependson = NULL, autodep = FALSE, cache.rebuild = FALSE, 
        fig.keep = "high", fig.show = "asis", fig.align = "default", 
        fig.path = "USU_files/figure-html/", dev = "png", dev.args = NULL, 
        dpi = 192, fig.ext = "png", fig.width = 7L, fig.height = 5L, 
        fig.env = "figure", fig.cap = NULL, fig.scap = NULL, 
        fig.lp = "fig:", fig.subcap = NULL, fig.pos = "", out.width = 672L, 
        out.height = NULL, out.extra = NULL, fig.retina = 2, 
        external = TRUE, sanitize = FALSE, interval = 1, aniopts = "controls,loop", 
        warning = TRUE, error = FALSE, message = TRUE, render = NULL, 
        ref.label = NULL, child = NULL, engine = "r", split = FALSE, 
        include = TRUE, purl = TRUE, fig.asp = NULL, fenced.echo = FALSE, 
        ft.shadow = FALSE, label = "mtcarsPlot", exercise = TRUE, 
        exercise.setup = "mtcarsSetup", original.params.src = "r mtcarsPlot, exercise=TRUE, exercise.setup=\"mtcarsSetup\"", 
        chunk.echo = FALSE, code = c("ggplot(mtcars, aes(x = wt, y = mpg)) + ", 
        "  geom_point() + ", "  labs(x = \"Car Weight (1000 lbs)\", y = \"Miles/Gallon\")"
        ), out.width.px = 672L, out.height.px = 480L, params.src = "r mtcarsPlot, exercise=TRUE, exercise.setup=\"mtcarsSetup\"", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-mtcarsAnova-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-mtcarsAnova-code-editor`)), session)
output$`tutorial-exercise-mtcarsAnova-output` <- renderUI({
  `tutorial-exercise-mtcarsAnova-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "mtcarsAnova", global_setup = structure(c("library(learnr)", 
"theme_set(theme_bw())"), chunk_opts = list(label = "setup", 
    eval = TRUE, include = FALSE, message = FALSE, echo = FALSE)), 
    setup = "data(\"mtcars\")", chunks = list(list(label = "mtcarsSetup", 
        code = "data(\"mtcars\")", opts = list(label = "\"mtcarsSetup\"", 
            echo = "FALSE", include = "FALSE"), engine = "r"), 
        list(label = "mtcarsAnova", code = "# Fit the full model\nfull_model <- lm(mpg ~ wt + hp + qsec + disp + drat, data = mtcars)\n\n# Fit the reduced model (nested within the full model)\nreduced_model <- lm(mpg ~ wt, data = mtcars)\n\nanova(reduced_model, full_model)", 
            opts = list(label = "\"mtcarsAnova\"", exercise = "TRUE", 
                exercise.setup = "\"mtcarsSetup\""), engine = "r")), 
    code_check = NULL, error_check = NULL, check = NULL, solution = NULL, 
    tests = NULL, options = list(eval = FALSE, echo = TRUE, results = "markup", 
        tidy = FALSE, tidy.opts = NULL, collapse = FALSE, prompt = FALSE, 
        comment = NA, highlight = FALSE, size = "normalsize", 
        background = "#F7F7F7", strip.white = TRUE, cache = 0, 
        cache.path = "USU_cache/html/", cache.vars = NULL, cache.lazy = TRUE, 
        dependson = NULL, autodep = FALSE, cache.rebuild = FALSE, 
        fig.keep = "high", fig.show = "asis", fig.align = "default", 
        fig.path = "USU_files/figure-html/", dev = "png", dev.args = NULL, 
        dpi = 192, fig.ext = "png", fig.width = 7L, fig.height = 5L, 
        fig.env = "figure", fig.cap = NULL, fig.scap = NULL, 
        fig.lp = "fig:", fig.subcap = NULL, fig.pos = "", out.width = 672L, 
        out.height = NULL, out.extra = NULL, fig.retina = 2, 
        external = TRUE, sanitize = FALSE, interval = 1, aniopts = "controls,loop", 
        warning = TRUE, error = FALSE, message = TRUE, render = NULL, 
        ref.label = NULL, child = NULL, engine = "r", split = FALSE, 
        include = TRUE, purl = TRUE, fig.asp = NULL, fenced.echo = FALSE, 
        ft.shadow = FALSE, label = "mtcarsAnova", exercise = TRUE, 
        exercise.setup = "mtcarsSetup", original.params.src = "r mtcarsAnova, exercise=TRUE, exercise.setup=\"mtcarsSetup\"", 
        chunk.echo = FALSE, code = c("# Fit the full model", 
        "full_model <- lm(mpg ~ wt + hp + qsec + disp + drat, data = mtcars)", 
        "", "# Fit the reduced model (nested within the full model)", 
        "reduced_model <- lm(mpg ~ wt, data = mtcars)", "", "anova(reduced_model, full_model)"
        ), out.width.px = 672L, out.height.px = 480L, params.src = "r mtcarsAnova, exercise=TRUE, exercise.setup=\"mtcarsSetup\"", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-adjR2-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-adjR2-code-editor`)), session)
output$`tutorial-exercise-adjR2-output` <- renderUI({
  `tutorial-exercise-adjR2-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "adjR2", global_setup = structure(c("library(learnr)", 
"theme_set(theme_bw())"), chunk_opts = list(label = "setup", 
    eval = TRUE, include = FALSE, message = FALSE, echo = FALSE)), 
    setup = "data(\"mtcars\")", chunks = list(list(label = "mtcarsSetup", 
        code = "data(\"mtcars\")", opts = list(label = "\"mtcarsSetup\"", 
            echo = "FALSE", include = "FALSE"), engine = "r"), 
        list(label = "adjR2", code = "car_mod <- lm(mpg~cyl+disp+hp+wt, data = mtcars)\nsummary(car_mod)", 
            opts = list(label = "\"adjR2\"", exercise = "TRUE", 
                exercise.setup = "\"mtcarsSetup\""), engine = "r")), 
    code_check = NULL, error_check = NULL, check = NULL, solution = NULL, 
    tests = NULL, options = list(eval = FALSE, echo = TRUE, results = "markup", 
        tidy = FALSE, tidy.opts = NULL, collapse = FALSE, prompt = FALSE, 
        comment = NA, highlight = FALSE, size = "normalsize", 
        background = "#F7F7F7", strip.white = TRUE, cache = 0, 
        cache.path = "USU_cache/html/", cache.vars = NULL, cache.lazy = TRUE, 
        dependson = NULL, autodep = FALSE, cache.rebuild = FALSE, 
        fig.keep = "high", fig.show = "asis", fig.align = "default", 
        fig.path = "USU_files/figure-html/", dev = "png", dev.args = NULL, 
        dpi = 192, fig.ext = "png", fig.width = 7L, fig.height = 5L, 
        fig.env = "figure", fig.cap = NULL, fig.scap = NULL, 
        fig.lp = "fig:", fig.subcap = NULL, fig.pos = "", out.width = 672L, 
        out.height = NULL, out.extra = NULL, fig.retina = 2, 
        external = TRUE, sanitize = FALSE, interval = 1, aniopts = "controls,loop", 
        warning = TRUE, error = FALSE, message = TRUE, render = NULL, 
        ref.label = NULL, child = NULL, engine = "r", split = FALSE, 
        include = TRUE, purl = TRUE, fig.asp = NULL, fenced.echo = FALSE, 
        ft.shadow = FALSE, label = "adjR2", exercise = TRUE, 
        exercise.setup = "mtcarsSetup", original.params.src = "r adjR2, exercise=TRUE, exercise.setup=\"mtcarsSetup\"", 
        chunk.echo = FALSE, code = c("car_mod <- lm(mpg~cyl+disp+hp+wt, data = mtcars)", 
        "summary(car_mod)"), out.width.px = 672L, out.height.px = 480L, 
        params.src = "r adjR2, exercise=TRUE, exercise.setup=\"mtcarsSetup\"", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-mtcarsAIC-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-mtcarsAIC-code-editor`)), session)
output$`tutorial-exercise-mtcarsAIC-output` <- renderUI({
  `tutorial-exercise-mtcarsAIC-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "mtcarsAIC", global_setup = structure(c("library(learnr)", 
"theme_set(theme_bw())"), chunk_opts = list(label = "setup", 
    eval = TRUE, include = FALSE, message = FALSE, echo = FALSE)), 
    setup = "data(\"mtcars\")", chunks = list(list(label = "mtcarsSetup", 
        code = "data(\"mtcars\")", opts = list(label = "\"mtcarsSetup\"", 
            echo = "FALSE", include = "FALSE"), engine = "r"), 
        list(label = "mtcarsAIC", code = "car_mod1 <- lm(mpg~cyl+disp+hp+wt, data = mtcars)\ncar_mod2 <- lm(mpg~hp+wt, data = mtcars)\nAIC(car_mod1)\nAIC(car_mod2)", 
            opts = list(label = "\"mtcarsAIC\"", exercise = "TRUE", 
                exercise.setup = "\"mtcarsSetup\""), engine = "r")), 
    code_check = NULL, error_check = NULL, check = NULL, solution = NULL, 
    tests = NULL, options = list(eval = FALSE, echo = TRUE, results = "markup", 
        tidy = FALSE, tidy.opts = NULL, collapse = FALSE, prompt = FALSE, 
        comment = NA, highlight = FALSE, size = "normalsize", 
        background = "#F7F7F7", strip.white = TRUE, cache = 0, 
        cache.path = "USU_cache/html/", cache.vars = NULL, cache.lazy = TRUE, 
        dependson = NULL, autodep = FALSE, cache.rebuild = FALSE, 
        fig.keep = "high", fig.show = "asis", fig.align = "default", 
        fig.path = "USU_files/figure-html/", dev = "png", dev.args = NULL, 
        dpi = 192, fig.ext = "png", fig.width = 7L, fig.height = 5L, 
        fig.env = "figure", fig.cap = NULL, fig.scap = NULL, 
        fig.lp = "fig:", fig.subcap = NULL, fig.pos = "", out.width = 672L, 
        out.height = NULL, out.extra = NULL, fig.retina = 2, 
        external = TRUE, sanitize = FALSE, interval = 1, aniopts = "controls,loop", 
        warning = TRUE, error = FALSE, message = TRUE, render = NULL, 
        ref.label = NULL, child = NULL, engine = "r", split = FALSE, 
        include = TRUE, purl = TRUE, fig.asp = NULL, fenced.echo = FALSE, 
        ft.shadow = FALSE, label = "mtcarsAIC", exercise = TRUE, 
        exercise.setup = "mtcarsSetup", original.params.src = "r mtcarsAIC, exercise=TRUE, exercise.setup=\"mtcarsSetup\"", 
        chunk.echo = FALSE, code = c("car_mod1 <- lm(mpg~cyl+disp+hp+wt, data = mtcars)", 
        "car_mod2 <- lm(mpg~hp+wt, data = mtcars)", "AIC(car_mod1)", 
        "AIC(car_mod2)"), out.width.px = 672L, out.height.px = 480L, 
        params.src = "r mtcarsAIC, exercise=TRUE, exercise.setup=\"mtcarsSetup\"", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-stepWise-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-stepWise-code-editor`)), session)
output$`tutorial-exercise-stepWise-output` <- renderUI({
  `tutorial-exercise-stepWise-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "stepWise", global_setup = structure(c("library(learnr)", 
"theme_set(theme_bw())"), chunk_opts = list(label = "setup", 
    eval = TRUE, include = FALSE, message = FALSE, echo = FALSE)), 
    setup = "data(\"mtcars\")", chunks = list(list(label = "mtcarsSetup", 
        code = "data(\"mtcars\")", opts = list(label = "\"mtcarsSetup\"", 
            echo = "FALSE", include = "FALSE"), engine = "r"), 
        list(label = "stepWise", code = "null_model <- lm(mpg ~ 1, data = mtcars)\nfull_model <- lm(mpg ~ ., data = mtcars)\n\nstep(full_model, direction = 'backward')", 
            opts = list(label = "\"stepWise\"", exercise = "TRUE", 
                exercise.setup = "\"mtcarsSetup\""), engine = "r")), 
    code_check = NULL, error_check = NULL, check = NULL, solution = structure(c("#### SOLUTION #### ", 
    "", "# Backwards", "step(full_model, direction = 'backward')", 
    "", "# Forwards", "step(", "  full_model, direction = 'forward',", 
    "  scope = list(upper = full_model)", ")", "", "# Forward-Backward", 
    "step(", "  null_model, direction = 'both',", "  scope = list(upper = full_model, lower = null_model)", 
    ")", "", "# Backward-Forward ", "step(", "  full_model, direction = 'both',", 
    "  scope = list(upper = full_model, lower = null_model)", 
    ")"), chunk_opts = list(label = "stepWise-solution")), tests = NULL, 
    options = list(eval = FALSE, echo = TRUE, results = "markup", 
        tidy = FALSE, tidy.opts = NULL, collapse = FALSE, prompt = FALSE, 
        comment = NA, highlight = FALSE, size = "normalsize", 
        background = "#F7F7F7", strip.white = TRUE, cache = 0, 
        cache.path = "USU_cache/html/", cache.vars = NULL, cache.lazy = TRUE, 
        dependson = NULL, autodep = FALSE, cache.rebuild = FALSE, 
        fig.keep = "high", fig.show = "asis", fig.align = "default", 
        fig.path = "USU_files/figure-html/", dev = "png", dev.args = NULL, 
        dpi = 192, fig.ext = "png", fig.width = 7L, fig.height = 5L, 
        fig.env = "figure", fig.cap = NULL, fig.scap = NULL, 
        fig.lp = "fig:", fig.subcap = NULL, fig.pos = "", out.width = 672L, 
        out.height = NULL, out.extra = NULL, fig.retina = 2, 
        external = TRUE, sanitize = FALSE, interval = 1, aniopts = "controls,loop", 
        warning = TRUE, error = FALSE, message = TRUE, render = NULL, 
        ref.label = NULL, child = NULL, engine = "r", split = FALSE, 
        include = TRUE, purl = TRUE, fig.asp = NULL, fenced.echo = FALSE, 
        ft.shadow = FALSE, label = "stepWise", exercise = TRUE, 
        exercise.setup = "mtcarsSetup", original.params.src = "r stepWise, exercise=TRUE, exercise.setup=\"mtcarsSetup\"", 
        chunk.echo = FALSE, code = c("null_model <- lm(mpg ~ 1, data = mtcars)", 
        "full_model <- lm(mpg ~ ., data = mtcars)", "", "step(full_model, direction = 'backward')"
        ), out.width.px = 672L, out.height.px = 480L, params.src = "r stepWise, exercise=TRUE, exercise.setup=\"mtcarsSetup\"", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-polyTestSet-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-polyTestSet-code-editor`)), session)
output$`tutorial-exercise-polyTestSet-output` <- renderUI({
  `tutorial-exercise-polyTestSet-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "polyTestSet", global_setup = structure(c("library(learnr)", 
"theme_set(theme_bw())"), chunk_opts = list(label = "setup", 
    eval = TRUE, include = FALSE, message = FALSE, echo = FALSE)), 
    setup = "set.seed(12345)\nn_train <- 200\nX_train <- rnorm(n_train, mean = 0, sd = 1)\nY_train <- 12 + 3*cos(X_train) + X_train + 0.5* X_train^2 - 0.16 * X_train^3 + ifelse(X_train > 1, 0.25*X_train^2, 0) + rnorm(n_train, sd = 1) \ndf_poly <- data.frame(\n  x = X_train, \n  y = Y_train\n)\n\nn_test <- 1000\nX_test <- rnorm(n_test, mean = 0, sd = 1)\nY_test <- 12 + 3*cos(X_test) + X_test + 0.5* X_test^2 - 0.16 * X_test^3 + ifelse(X_test > 1, 0.25*X_test^2, 0) + rnorm(n_test, sd = 1) \ndf_poly_test <- data.frame(\n  x = X_test, \n  y = Y_test\n)", 
    chunks = list(list(label = "polyTestSet-setup", code = "set.seed(12345)\nn_train <- 200\nX_train <- rnorm(n_train, mean = 0, sd = 1)\nY_train <- 12 + 3*cos(X_train) + X_train + 0.5* X_train^2 - 0.16 * X_train^3 + ifelse(X_train > 1, 0.25*X_train^2, 0) + rnorm(n_train, sd = 1) \ndf_poly <- data.frame(\n  x = X_train, \n  y = Y_train\n)\n\nn_test <- 1000\nX_test <- rnorm(n_test, mean = 0, sd = 1)\nY_test <- 12 + 3*cos(X_test) + X_test + 0.5* X_test^2 - 0.16 * X_test^3 + ifelse(X_test > 1, 0.25*X_test^2, 0) + rnorm(n_test, sd = 1) \ndf_poly_test <- data.frame(\n  x = X_test, \n  y = Y_test\n)", 
        opts = list(label = "\"polyTestSet-setup\""), engine = "r"), 
        list(label = "polyTestSet", code = "# Function to evaluate MSE of model predictions\nMSE <- function(Y, Y_hat) {\n  mean((Y - Y_hat)^2)\n}\n\n# Set the maximum degree of the polynomial model\nmax_p <- 7\n\n# Create a data.frame object to save results of training data\nresults_train <- data.frame(\n  degree = 1:max_p, \n  MSE = NA_real_, \n  set = 'train'\n)\n\n# Create a data.frame object to save results of testing data \nresults_test <- data.frame(\n  degree = 1:max_p, \n  MSE = NA_real_, \n  set = 'test'\n)\n\n# For each p in 1:max_p, fit a polynomial model of degree p, and calculate \n# the MSE on the training and testing data.\nfor (p in 1:max_p) {\n  \n  # Fit model on training data \n  poly_model <- lm(y~poly(x, p), data = df_poly)\n  \n  # Make Y predictions on training data\n  train_predictions <- predict(poly_model, newdata = df_poly)\n  \n  # Make Y predictions on testing data \n  test_predictions <- predict(poly_model, newdata = df_poly_test)\n  \n  # Calculate MSE and save the results \n  results_train[p, 'MSE'] <- MSE(df_poly$y, train_predictions)\n  results_test[p, 'MSE'] <- MSE(df_poly_test$y, test_predictions)\n}\n\n# Combine results into a single data.frame object \nresults <- dplyr::bind_rows(\n  results_train, results_test\n)\n\n# Plot the results\nggplot(results, aes(x = degree, y = MSE, col = set)) + \n  geom_line(aes(y = MSE)) + \n  xlab(\"Polynomial Degree\")", 
            opts = list(label = "\"polyTestSet\"", exercise = "TRUE"), 
            engine = "r")), code_check = NULL, error_check = NULL, 
    check = NULL, solution = NULL, tests = NULL, options = list(
        eval = FALSE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "USU_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "USU_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = TRUE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fig.asp = NULL, fenced.echo = FALSE, ft.shadow = FALSE, 
        label = "polyTestSet", exercise = TRUE, original.params.src = "r polyTestSet, exercise=TRUE", 
        chunk.echo = FALSE, code = c("# Function to evaluate MSE of model predictions", 
        "MSE <- function(Y, Y_hat) {", "  mean((Y - Y_hat)^2)", 
        "}", "", "# Set the maximum degree of the polynomial model", 
        "max_p <- 7", "", "# Create a data.frame object to save results of training data", 
        "results_train <- data.frame(", "  degree = 1:max_p, ", 
        "  MSE = NA_real_, ", "  set = 'train'", ")", "", "# Create a data.frame object to save results of testing data ", 
        "results_test <- data.frame(", "  degree = 1:max_p, ", 
        "  MSE = NA_real_, ", "  set = 'test'", ")", "", "# For each p in 1:max_p, fit a polynomial model of degree p, and calculate ", 
        "# the MSE on the training and testing data.", "for (p in 1:max_p) {", 
        "  ", "  # Fit model on training data ", "  poly_model <- lm(y~poly(x, p), data = df_poly)", 
        "  ", "  # Make Y predictions on training data", "  train_predictions <- predict(poly_model, newdata = df_poly)", 
        "  ", "  # Make Y predictions on testing data ", "  test_predictions <- predict(poly_model, newdata = df_poly_test)", 
        "  ", "  # Calculate MSE and save the results ", "  results_train[p, 'MSE'] <- MSE(df_poly$y, train_predictions)", 
        "  results_test[p, 'MSE'] <- MSE(df_poly_test$y, test_predictions)", 
        "}", "", "# Combine results into a single data.frame object ", 
        "results <- dplyr::bind_rows(", "  results_train, results_test", 
        ")", "", "# Plot the results", "ggplot(results, aes(x = degree, y = MSE, col = set)) + ", 
        "  geom_line(aes(y = MSE)) + ", "  xlab(\"Polynomial Degree\")"
        ), out.width.px = 672L, out.height.px = 480L, params.src = "r polyTestSet, exercise=TRUE", 
        fig.num = 0, exercise.df_print = "default", exercise.checker = "NULL"), 
    engine = "r", version = "4"), class = c("r", "tutorial_exercise"
)))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-mtcarsCV-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-mtcarsCV-code-editor`)), session)
output$`tutorial-exercise-mtcarsCV-output` <- renderUI({
  `tutorial-exercise-mtcarsCV-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_cache(structure(list(label = "mtcarsCV", global_setup = structure(c("library(learnr)", 
"theme_set(theme_bw())"), chunk_opts = list(label = "setup", 
    eval = TRUE, include = FALSE, message = FALSE, echo = FALSE)), 
    setup = "data(\"mtcars\")", chunks = list(list(label = "mtcarsSetup", 
        code = "data(\"mtcars\")", opts = list(label = "\"mtcarsSetup\"", 
            echo = "FALSE", include = "FALSE"), engine = "r"), 
        list(label = "mtcarsCV", code = "set.seed(1)  # for reproducibility\nhead(mtcars)", 
            opts = list(label = "\"mtcarsCV\"", exercise = "TRUE", 
                exercise.setup = "\"mtcarsSetup\"", exercise.eval = "TRUE"), 
            engine = "r")), code_check = NULL, error_check = NULL, 
    check = NULL, solution = NULL, tests = NULL, options = list(
        eval = TRUE, echo = TRUE, results = "markup", tidy = FALSE, 
        tidy.opts = NULL, collapse = FALSE, prompt = FALSE, comment = NA, 
        highlight = FALSE, size = "normalsize", background = "#F7F7F7", 
        strip.white = TRUE, cache = 0, cache.path = "USU_cache/html/", 
        cache.vars = NULL, cache.lazy = TRUE, dependson = NULL, 
        autodep = FALSE, cache.rebuild = FALSE, fig.keep = "high", 
        fig.show = "asis", fig.align = "default", fig.path = "USU_files/figure-html/", 
        dev = "png", dev.args = NULL, dpi = 192, fig.ext = "png", 
        fig.width = 7L, fig.height = 5L, fig.env = "figure", 
        fig.cap = NULL, fig.scap = NULL, fig.lp = "fig:", fig.subcap = NULL, 
        fig.pos = "", out.width = 672L, out.height = NULL, out.extra = NULL, 
        fig.retina = 2, external = TRUE, sanitize = FALSE, interval = 1, 
        aniopts = "controls,loop", warning = TRUE, error = FALSE, 
        message = TRUE, render = NULL, ref.label = NULL, child = NULL, 
        engine = "r", split = FALSE, include = TRUE, purl = TRUE, 
        fig.asp = NULL, fenced.echo = FALSE, ft.shadow = FALSE, 
        label = "mtcarsCV", exercise = TRUE, exercise.setup = "mtcarsSetup", 
        exercise.eval = TRUE, original.params.src = "r mtcarsCV, exercise=TRUE, exercise.setup=\"mtcarsSetup\", exercise.eval=TRUE", 
        chunk.echo = FALSE, code = c("set.seed(1)  # for reproducibility", 
        "head(mtcars)"), out.width.px = 672L, out.height.px = 480L, 
        params.src = "r mtcarsCV, exercise=TRUE, exercise.setup=\"mtcarsSetup\", exercise.eval=TRUE", 
        fig.alt = NULL, fig.num = 0, exercise.df_print = "default", 
        exercise.checker = "NULL"), engine = "r", version = "4"), class = c("r", 
"tutorial_exercise")))
</script>
 
<script type="application/shiny-prerendered" data-context="server-extras">
ojs_define <- function(..., .session = shiny::getDefaultReactiveDomain()) {
  quos <- rlang::enquos(...)
  vars <- rlang::list2(...)
  nm <- names(vars)
  if (is.null(nm)) {
    nm <- rep_len("", length(vars))
  }
  mapply(function(q, nm, val) {
    # Infer name, if possible
    if (nm == "") {
      tryCatch({
        nm <- rlang::as_name(q)
      }, error = function(e) {
        code <- paste(collapse = "\n", deparse(rlang::f_rhs(q)))
        stop("ojs_define() could not create a name for the argument: ", code)
      })
    }
    .session$output[[nm]] <- val
    outputOptions(.session$output, nm, suspendWhenHidden = FALSE)
    .session$sendCustomMessage("ojs-export", list(name = nm))
    NULL
  }, quos, nm, vars, SIMPLIFY = FALSE, USE.NAMES = FALSE)
  invisible()
}
</script>
</p>
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["3.6.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/3.6.0"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery-3.6.0.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquerylib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.1.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["font-awesome"]},{"type":"character","attributes":{},"value":["6.4.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fontawesome"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["css/all.min.css","css/v4-shims.min.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fontawesome"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.2"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bootbox"]},{"type":"character","attributes":{},"value":["5.5.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/bootbox"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["bootbox.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["idb-keyvalue"]},{"type":"character","attributes":{},"value":["3.2.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/idb-keyval"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["idb-keyval-iife-compat.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial"]},{"type":"character","attributes":{},"value":["0.11.5"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial.js"]},{"type":"character","attributes":{},"value":["tutorial.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["2.0.10"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.11.5"]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60]}},"value":[{"type":"character","attributes":{},"value":["base","cli","colorspace","compiler","datasets","digest","dplyr","evaluate","fansi","farver","fastmap","fontawesome","generics","ggplot2","glue","graphics","grDevices","grid","gridExtra","gtable","htmltools","htmlwidgets","httpuv","jquerylib","jsonlite","knitr","labeling","later","lattice","learnr","lifecycle","magrittr","Matrix","methods","mgcv","mime","munsell","nlme","pillar","pkgconfig","promises","R6","Rcpp","rlang","rmarkdown","rprojroot","scales","shiny","splines","stats","tibble","tidyselect","tools","utf8","utils","vctrs","withr","xfun","xtable","yaml"]},{"type":"character","attributes":{},"value":["4.4.1","3.6.3","2.1-1","4.4.1","4.4.1","0.6.36","1.1.4","0.24.0","1.0.6","2.1.2","1.2.0","0.5.2","0.1.3","3.5.1","1.7.0","4.4.1","4.4.1","4.4.1","2.3","0.3.5","0.5.8.1","1.6.4","1.6.15","0.1.4","1.8.9","1.48","0.4.3","1.3.2","0.22-6","0.11.5","1.0.4","2.0.3","1.7-0","4.4.1","1.9-1","0.12","0.5.1","3.1-164","1.9.0","2.0.3","1.3.0","2.5.1","1.0.12","1.1.4","2.27","2.0.4","1.3.0","1.8.1.1","4.4.1","4.4.1","3.2.1","1.2.1","4.4.1","1.2.4","4.4.1","0.6.5","3.0.1","0.46","1.8-4","2.3.10"]}]}]}
</script>
<!--/html_preserve-->


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/jeswheel\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>